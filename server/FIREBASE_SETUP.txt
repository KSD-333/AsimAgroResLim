# Firebase Setup Guide for Asim Agro

## Overview
This application now uses Firebase Firestore as the database instead of MongoDB.

## Setup Steps

### 1. Create a Firebase Project
1. Go to https://console.firebase.google.com
2. Click "Add Project"
3. Enter project name and follow setup wizard

### 2. Enable Firestore Database
1. In Firebase Console, click "Firestore Database"
2. Click "Create Database"
3. Choose "Start in production mode" (we'll set rules later)
4. Select your preferred location

### 3. Get Firebase Web Credentials (Frontend)
1. Go to Project Settings > General
2. Scroll to "Your apps" section
3. Click the web icon (</>)
4. Register your app and copy the config
5. Create `.env` file in project root with:
```
VITE_FIREBASE_API_KEY=...
VITE_FIREBASE_AUTH_DOMAIN=...
VITE_FIREBASE_PROJECT_ID=...
VITE_FIREBASE_STORAGE_BUCKET=...
VITE_FIREBASE_MESSAGING_SENDER_ID=...
VITE_FIREBASE_APP_ID=...
VITE_FIREBASE_MEASUREMENT_ID=...
```

### 4. Get Firebase Admin SDK Credentials (Backend)
1. Go to Project Settings > Service Accounts
2. Click "Generate New Private Key"
3. Download the JSON file
4. Create `.env` file in `server/` folder with:
```
FIREBASE_PROJECT_ID=from_json_file
FIREBASE_PRIVATE_KEY="from_json_file"
FIREBASE_CLIENT_EMAIL=from_json_file
```

**IMPORTANT:** The private key must be wrapped in quotes and newlines should be actual `\n` characters.

### 5. Enable Authentication
1. Go to Authentication in Firebase Console
2. Click "Get Started"
3. Enable "Email/Password" sign-in method

### 6. Set up Firestore Security Rules
Go to Firestore Database > Rules and paste:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId || 
                    get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Products - public read, admin write
    match /products/{productId} {
      allow read: if true;
      allow write: if request.auth != null && 
                    get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Orders - user can read their own, admin can read all
    match /orders/{orderId} {
      allow read: if request.auth != null && 
                   (resource.data.firebaseUid == request.auth.uid || 
                    get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
                     get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // Carts - user can only access their own
    match /carts/{cartId} {
      allow read, write: if request.auth != null && request.auth.uid == cartId;
    }
    
    // Reviews - authenticated users can write, everyone can read approved
    match /reviews/{reviewId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
                              (resource.data.firebaseUid == request.auth.uid || 
                               get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin');
    }
    
    // Contact forms, feedback, messages - user can create, admin can manage
    match /{collection}/{docId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
                              get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
```

### 7. Create Initial Admin User
1. Start your application
2. Register a new user via the signup page
3. Go to Firebase Console > Firestore Database
4. Find your user in the `users` collection
5. Click on the document
6. Change the `role` field from "user" to "admin"
7. Click "Update"

### 8. Firestore Collections Structure

Your Firestore will have these collections:

- **users** - User accounts and profiles
- **products** - Product catalog with details
- **orders** - Customer orders
- **carts** - Shopping cart data
- **reviews** - Product reviews
- **contactForms** - Contact form submissions
- **feedback** - User feedback
- **orderMessages** - Order-related messages

### 9. Create Composite Indexes (if needed)

If you get errors about missing indexes, Firebase will provide a link to create them automatically.

Common indexes needed:
- `reviews`: (productId, isApproved, createdAt)
- `orders`: (firebaseUid, createdAt)
- `products`: (isActive, isFeatured, createdAt)

## Migration from MongoDB

If you had MongoDB data:
1. Export data from MongoDB collections
2. Convert to Firestore format
3. Import using Firebase Admin SDK or Firebase Console

## Cloudinary Setup (Image Uploads)

1. Create account at https://cloudinary.com
2. Get your Cloud Name, API Key, and API Secret from Dashboard
3. Add to server/.env:
```
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

## Done! ðŸŽ‰

Your application is now using Firebase Firestore instead of MongoDB.
Run `npm run dev` from project root to start both frontend and backend.
